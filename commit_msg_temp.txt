Resumen: C칩mo se construy칩 y c칩mo funciona la ventana (di치logo) de "Compra Registrada"

Archivos relevantes:
- `app/src/main/java/com/universidad/streamzone/ui/home/PurchaseCompleteDialogFragment.kt`
  - Clase Kotlin que extiende DialogFragment y controla la l칩gica del di치logo.
- `app/src/main/res/layout/dialog_purchase_complete.xml`
  - Layout XML que define la interfaz visual del di치logo.

1) 쯈u칠 hace esta ventana?
- Muestra un di치logo modal que informa al usuario que su compra fue registrada.
- Indica un paso obligatorio: contactar por WhatsApp para confirmar la compra y recibir credenciales.
- Ofrece un bot칩n para seleccionar un "agente" que abre WhatsApp con un mensaje preformateado.
- Tiene un bot칩n para cerrar el di치logo.

2) Estructura del layout (`dialog_purchase_complete.xml`)
- Root: LinearLayout vertical con padding y fondo `@drawable/dialog_bg`.
- Encabezado: LinearLayout horizontal que contiene:
  - `TextView` (`@id/tvCompleteTitle`): t칤tulo central/izquierda ("춰Compra Registrada! 游꿀")
  - `AppCompatImageButton` (`@id/btnCloseComplete`): bot칩n de cerrar con 칤cono `@drawable/ic_close_black_24dp`.
- Espacio (Space) para separaci칩n.
- Caja informativa obligatoria: LinearLayout vertical con fondo `@drawable/important_box` y padding que contiene dos TextView:
  - `tvObligatorioTitle` ("PASO OBLIGATORIO")
  - `tvObligatorioText` (texto que indica contactar por WhatsApp)
- M치s espacio y un `TextView` explicativo (`tvSelectAgent`) que pide seleccionar un agente.
- `Button` (`btnAgent`) con fondo `@drawable/button_gradient_green` que act칰a como accion principal (abrir WhatsApp).

3) L칩gica del fragment (`PurchaseCompleteDialogFragment.kt`)
- Argumentos: la clase define 3 argumentos de Bundle opcionales: `service`, `total`, `user`. Hay un constructor est치tico `newInstance(service, total, user)` que los empaqueta.
- En `onCreate` se leen los argumentos con valores por defecto vac칤os y se aplica un estilo al di치logo: `setStyle(STYLE_NORMAL, android.R.style.Theme_DeviceDefault_Dialog_Alert)`.
- En `onCreateView` se infla `R.layout.dialog_purchase_complete` y se referencian las vistas:
  - `btnClose` (ImageButton): al hacer click llama a `dismiss()` para cerrar el di치logo.
  - `btnAgent` (Button): al cargar intenta obtener un texto para mostrar el n칰mero de WhatsApp (recurso `whatsapp_number_display`) y formatea el texto del bot칩n con `agent_button_template` (si existe). Si falla, deja el texto por defecto del layout.
  - Al pulsar `btnAgent` se obtiene el n칰mero de tel칠fono desde el recurso `whatsapp_number` (ejemplo: "593984280334"). Se construye un mensaje usando `whatsapp_message_template` pasando `service` y `total` (si est치n vac칤os, se sustituye por "-").
  - Se compone una URL para abrir WhatsApp Web/APP: `https://wa.me/{phone}?text={Uri.encode(message)}` y se lanza un `Intent.ACTION_VIEW` con esa URL. Si falla, muestra un Toast "No se pudo abrir WhatsApp".

4) Recursos externos necesarios (verifica que existan en `res/values` y `res/drawable`):
- drawables usados en layout: `dialog_bg`, `important_box`, `button_gradient_green`, `ic_close_black_24dp`.
- colores: `@color/text_primary`, `@color/text_secondary`, `@color/orange_500`, `@color/close_red`.
- strings (mencionadas en el fragment):
  - `whatsapp_number_display` (ej. texto corto que muestre el n칰mero con formato legible)
  - `whatsapp_number` (sin espacios: el n칰mero internacional, p. ej. 593984280334)
  - `whatsapp_message_template` (plantilla con placeholders para servicio y total)
  - `agent_button_template` (plantilla del texto del bot칩n que incluya el n칰mero legible)
Si alguno falta, hay fallbacks en el c칩digo (valor por defecto del n칰mero y mensaje fallback).

5) Flujo de ejecuci칩n (paso a paso)
- Otra parte de la app crea el di치logo mediante `PurchaseCompleteDialogFragment.newInstance(service, total, user)` y lo muestra (ej. `show(...)`).
- Al crearse el fragmento, `onCreate` lee los argumentos.
- Al inflarse la vista (`onCreateView`): se actualiza el t칤tulo si se recibi칩 `service`; se formatea el texto del bot칩n agente con el n칰mero visible; se asignan listeners:
  - Close -> cierra el di치logo.
  - Agent -> construye URL de WhatsApp y lanza Intent para abrirla.

6) Casos l칤mite y recomendaciones
- Si WhatsApp no est치 instalado y el sistema no sabe abrir `https://wa.me/...`, Android abrir치 el navegador web con esa URL; eso normalmente funciona. Si tampoco hay navegador, se captura la excepci칩n y se muestra un Toast.
- Validar que `whatsapp_number` est칠 en formato E.164 sin signos ni espacios (ej. "593984280334") para que `wa.me` funcione correctamente.
- Si deseas abrir directamente la app de WhatsApp en lugar de la web, se podr칤a usar un Intent con paquete `com.whatsapp` (requiere comprobar si est치 instalada).
- Usar `Uri.encode(message)` es correcto para evitar problemas con caracteres especiales.
- Asegurar que los recursos de strings est칠n traducidos si la app es multi-idioma.

7) C칩mo mejorar o extender
- A침adir logs para monitorear errores al crear el Intent.
- Mostrar un di치logo de confirmaci칩n si el usuario abre WhatsApp correctamente o si cancel칩.
- Hacer el di치logo m치s accesible (contentDescription en botones, roles para TalkBack).
- A침adir tests unitarios/Android tests que comprueben:
  - Que los argumentos se lean correctamente.
  - Que el bot칩n cierra el di치logo.
  - Que al pulsar el bot칩n se construye la URL esperada (mockear Intents).

8) C칩mo reutilizar este componente
- Llamar `PurchaseCompleteDialogFragment.newInstance(service, total, user)` desde cualquier Activity/Fragment y usar `show(parentFragmentManager, "purchase_complete")`.
- Cambiar los drawables o estilos si quieres un look diferente.

9) Prueba r치pida (manual)
- Ejecutar la app en un emulador o dispositivo.
- Alcanzar la pantalla que dispara el di치logo (o crear un bot칩n de test que haga `PurchaseCompleteDialogFragment.newInstance("Netflix", "4.00", "jeremias").show(supportFragmentManager, "pc")`).
- Pulsar "Selecciona un agente" y verificar que se abra WhatsApp o el navegador con la URL `https://wa.me/...` y que el mensaje est칠 correctamente codificado.

10) Resumen breve t칠cnico
- UI: `dialog_purchase_complete.xml` (LinearLayouts, TextViews, Button, ImageButton).
- L칩gica: `PurchaseCompleteDialogFragment.kt` (lectura de argumentos, formateo de texto, Intent para WhatsApp, manejo simple de errores).

